{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
<form method="GET" action="{{ url_for('feed') }}" class="d-flex mb-4">
  <input type="text" name="q" class="form-control me-2" placeholder="Search posts..." value="{{ search_query }}">
  <button class="btn btn-primary" type="submit">üîç Search</button>
</form>
  <h3 class="mb-4">üåç Community Feed</h3>

  {% if works %}
    {% for work in works %}
      <div class="card mb-4 shadow-sm">
        <div class="card-body">
          <!-- Work header -->
          <div class="d-flex justify-content-between align-items-center mb-2">
            <strong>{{ work.user.fullname }}</strong>
            <small class="text-muted">Work #{{ work.id }}</small>
          </div>

          <!-- Title & Description -->
          <h5>{{ work.title }}</h5>
          <p>{{ work.description }}</p>

          <!-- Media -->
          {% if work.media_filename %}
            {% if work.media_type == "image" %}
              <img src="{{ url_for('static', filename='uploads/' ~ work.media_filename) }}"
                   class="img-fluid rounded mb-3" style="max-height:300px;object-fit:cover;">
            {% elif work.media_type == "video" %}
              <video controls class="w-100 rounded mb-3" style="max-height:400px;">
                <source src="{{ url_for('static', filename='uploads/' ~ work.media_filename) }}" type="video/mp4">
              </video>
            {% endif %}
          {% endif %}

          <!-- Actions -->
          <div class="d-flex gap-2">
            <!-- Like -->
            <a href="{{ url_for('like_work', work_id=work.id) }}" class="btn btn-sm btn-outline-primary">
              üëç Like ({{ work.likes|length }})
            </a>

            <!-- Comment -->
            <button class="btn btn-sm btn-outline-info" data-bs-toggle="modal" data-bs-target="#commentModal{{ work.id }}">
              üí¨ Comment ({{ work.comments|length }})
            </button>

            <!-- Collaboration -->
            {% if work.user_id != current_user.id %}
              <button class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#collabModal{{ work.id }}">
                ü§ù Collaboration
              </button>
            {% endif %}
          </div>
        </div>
      </div>

      {% include 'modals/comment_modal.html' %}
      {% include 'modals/collab_modal.html' %}
    {% endfor %}
  {% else %}
    <p class="text-muted">No works uploaded yet.</p>
  {% endif %}
</div>

{% endblock %}
