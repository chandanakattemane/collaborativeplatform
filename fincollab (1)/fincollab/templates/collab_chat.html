{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <div class="card shadow p-3">
    <h5>
      Chat: {{ req.sender.fullname }} ü§ù {{ req.work.user.fullname }}
    </h5>
    <p class="text-muted">
      Collaboration on: <strong>{{ req.work.title }}</strong>
    </p>
    
    <!-- Chat messages -->
    <div class="border rounded p-3 mb-3" style="height: 400px; overflow-y: auto;">
      {% for msg in messages %}
        <div class="mb-2 {% if msg.sender_id == current_user.id %}text-end{% endif %}">
          <div class="p-2 rounded {% if msg.sender_id == current_user.id %}bg-primary text-white{% else %}bg-light{% endif %}">
            <strong>{{ msg.sender.username }}</strong><br>
            {{ msg.text }}
            <small class="d-block text-muted">{{ msg.timestamp.strftime("%d %b %Y %H:%M") }}</small>
          </div>
        </div>
      {% else %}
        <p class="text-muted">No messages yet. Start chatting!</p>
      {% endfor %}
    </div>

    <!-- Send message -->
    <form action="{{ url_for('send_collab_message', req_id=req.id) }}" method="post">
      <div class="input-group">
        <input type="text" class="form-control" name="text" placeholder="Type your message..." required>
        <button type="submit" class="btn btn-primary">Send</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
