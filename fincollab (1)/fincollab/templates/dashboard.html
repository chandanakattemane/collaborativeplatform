{% extends "base.html" %}
{% block content %}
<div class="container mt-4">

  <!-- User Card -->
  <div class="card p-4 mb-4">
    <div class="row align-items-center">
      <div class="col-md-2 text-center">
        {% if current_user.profile_pic %}
          <img src="{{ url_for('static', filename='uploads/' ~ current_user.profile_pic) }}" 
               class="rounded-circle" style="width:90px;height:90px;object-fit:cover;">
        {% else %}
          <img src="{{ url_for('static', filename='img/default_avatar.png') }}" 
               class="rounded-circle" style="width:90px;height:90px;object-fit:cover;">
        {% endif %}
      </div>
      <div class="col-md-6">
        <h5>üëã {{ current_user.fullname or current_user.username }}</h5>
        <p class="mb-1 text-muted">{{ current_user.username }}@example.com</p>
        <span class="badge bg-danger">Joined {{ current_user.created_at.date() }}</span>
      </div>
      <div class="col-md-4 text-md-end">
        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#editProfileModal">Edit Profile</button>
        <a href="{{ url_for('logout') }}" class="btn btn-sm btn-danger">Logout</a>
      </div>
    </div>
  </div>

  <!-- Stats -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card shadow-sm text-center p-3">
      <h5>üñºÔ∏è Total Works</h5>
      <h2>{{ total_works }}</h2>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm text-center p-3">
      <h5>ü§ù Collaborations</h5>
      <h2>{{ total_collabs }}</h2>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm text-center p-3">
      <h5>üåü Talents</h5>
      <h2>{{ total_talents }}</h2>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm text-center p-3">
      <h5>üìÇ Categories</h5>
      <h2>{{ total_categories }}</h2>
    </div>
  </div>
</div>
  <!-- Quick Actions -->
  <div class="card p-3 mb-4">
    <h5>‚ö° Quick Actions</h5>
    <div class="mt-2">
      <a href="#uw" class="btn btn-success me-2">Upload New Work</a>
      <a href="#uw1" class="btn btn-info me-2">Explore Artists</a>
      <a href="#uw2" class="btn btn-warning">Check Messages</a>
    </div>
  </div>

  <!-- Creative Works -->
  <div class="card p-4 mb-4" id="uw">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5>üé® My Creative Works</h5>
    <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#addWorkModal">
      Upload New Work
    </button>
  </div>

  {% if works %}
    {% for work in works %}
      <div class="card mb-3">
        <div class="card-body">
          <h6>{{ work.title }}</h6>
          <p>{{ work.description }}</p>
          
          {% if work.media_filename %}
            {% if work.media_type == "image" %}
              <img src="{{ url_for('static', filename='uploads/' ~ work.media_filename) }}" 
                   class="img-fluid rounded mb-2" style="max-height:200px;object-fit:cover;">
            {% elif work.media_type == "video" %}
              <video controls class="w-100 rounded mb-2" style="max-height:300px;">
                <source src="{{ url_for('static', filename='uploads/' ~ work.media_filename) }}" type="video/mp4">
              </video>
            {% endif %}
          {% endif %}

          <!-- Action Buttons -->
          <!-- Action Buttons -->
<div>
  <a href="{{ url_for('like_work', work_id=work.id) }}" class="btn btn-sm btn-outline-primary">
    üëç Like ({{ work.likes|length }})
  </a>
  <button class="btn btn-sm btn-outline-info" data-bs-toggle="modal" data-bs-target="#commentModal{{ work.id }}">
    üí¨ Comment ({{ work.comments|length }})
  </button>
  <button class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#collabModal{{ work.id }}">
  ü§ù Collaboration
</button>
  <button class="btn btn-sm btn-outline-warning" data-bs-toggle="modal" data-bs-target="#editWorkModal{{ work.id }}">
    ‚úèÔ∏è Edit
  </button>
</div>

{% include 'modals/edit_work_modal.html' %}
{% include 'modals/comment_modal.html' %}
{% include 'modals/collab_modal.html' %}
        </div>
      </div>

      {% include 'modals/edit_work_modal.html' %}
    {% endfor %}
  {% else %}
    <p class="text-muted">No works uploaded yet</p>
  {% endif %}
</div>

{% include 'modals/add_work_modal.html' %}
  <!-- Collaboration Opportunities -->
  <!-- Collaboration Opportunities -->
<div class="card p-4 mb-4" id="uw1">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5>üåü Collaboration Opportunities</h5>
    <!-- Search Input -->
    <input type="text" id="userSearchInput" class="form-control form-control-sm" 
           placeholder="Search by name..." style="width:200px;">
  </div>

  <p class="text-muted">Discover other creative users and check their works</p>

  <div class="row" id="userCardsContainer">
    {% for user in other_users %}
      <div class="col-md-3 mb-3 user-card">
        <div class="card h-100 text-center shadow-sm">
          <div class="card-body">
            <img src="{{ url_for('static', filename='uploads/' ~ user.profile_pic) if user.profile_pic else url_for('static', filename='default.png') }}" 
                 class="rounded-circle mb-2" 
                 style="width: 80px; height: 80px; object-fit: cover;">
            <h6 class="card-title">{{ user.fullname }}</h6>
            <a href="{{ url_for('user_dashboard', user_id=user.id) }}" class="btn btn-sm btn-outline-primary">
              View Profile
            </a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<!-- Client-Side Search Script -->
<script>
document.getElementById('userSearchInput').addEventListener('keyup', function() {
    const query = this.value.toLowerCase();
    const cards = document.querySelectorAll('.user-card');

    cards.forEach(card => {
        const name = card.querySelector('.card-title').innerText.toLowerCase();
        if (name.includes(query)) {
            card.style.display = '';
        } else {
            card.style.display = 'none';
        }
    });
});
</script>


<div class="card p-4 mb-4" id="uw2">
  <h5>ü§ù Collaboration Requests</h5>

  {% if collab_requests %}
    <ul class="list-group">
      {% for req in collab_requests %}
        <li class="list-group-item">
          <div class="d-flex justify-content-between">
            <div>
              <strong>{{ req.sender.fullname }}</strong> wants to collaborate on 
              <em>{{ req.work.title }}</em><br>
              <small class="text-muted">{{ req.timestamp.strftime("%d %b %Y %H:%M") }}</small>
              <p class="mb-1">{{ req.message }}</p>
              <span class="badge bg-secondary">{{ req.status }}</span>
            </div>
            <div class="d-flex gap-2">
              {% if req.status == "pending" %}
                <a href="{{ url_for('accept_collab', req_id=req.id) }}" class="btn btn-sm btn-success">Accept</a>
                <a href="{{ url_for('reject_collab', req_id=req.id) }}" class="btn btn-sm btn-danger">Reject</a>
              {% endif %}
              {% if req.status == "accepted" %}
                <a href="{{ url_for('collab_chat', req_id=req.id) }}" class="btn btn-sm btn-primary">
                  üí¨ Open Chat
                </a>
              {% endif %}
            </div>
          </div>
        </li>

        {% include 'modals/chat_modal.html' %}
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">No collaboration requests yet.</p>
  {% endif %}
</div>




















</div>
{% include 'modals/edit_profile_modal.html' %}
{% endblock %}
